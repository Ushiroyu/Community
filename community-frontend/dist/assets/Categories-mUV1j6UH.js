import"./index-BRtYqat6.js";import{v as x,E as U,a as w}from"./el-table-column-KoNqeqPg.js";import{E as N}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-eEMXupeW.js";/* empty css               */import{_ as $,E as z}from"./_plugin-vue_export-helper-BH_is9DS.js";/* empty css                 */import{h as f,E as t}from"./http-y0YsLSxU.js";import{E as T}from"./index-C9h3pgbl.js";import{r as b,K as M,p as K,c as L,o as C,a as s,E as r,D as n,U as P,B as E,R,P as _}from"./vendor-vue-CpX8Jn4o.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./vendor-icons-CDwfVtjd.js";import"./index-BquL_2tb.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";import"./typescript-Bp3YSIOJ.js";const j=()=>f.get("/categories"),q=d=>f.post("/categories",d),A=(d,m)=>f.put(`/categories/${d}`,m),F=d=>f.delete(`/categories/${d}`),G={class:"page-wrap admin-categories"},H={class:"page-card category-form","aria-labelledby":"admin-categories-form-title","aria-describedby":"admin-categories-form-tip"},J={class:"form-grid"},O={class:"table-card",role:"region","aria-labelledby":"admin-categories-table-title"},Q={class:"table-card__body"},S={__name:"Categories",setup(d){const m=b([]),c=b(!1),v=b(!1),l=M({name:"",parentId:""}),p=async()=>{var a;c.value=!0;try{const e=await j();if(e.code===0){const g=e.categories||((a=e.data)==null?void 0:a.categories)||[];m.value=g.map(i=>({...i,_name:i.name,_saving:!1,_removing:!1}))}else t.error(e.msg||"加载分类失败")}catch(e){t.error(e.message||"加载失败")}finally{c.value=!1}},I=async()=>{if(!l.name){t.error("请输入分类名称");return}v.value=!0;try{const a=await q({name:l.name,parentId:l.parentId||null});a.code===0?(t.success("分类已新增"),l.name="",l.parentId="",await p()):t.error(a.msg||"新增失败")}catch(a){t.error(a.message||"新增失败")}finally{v.value=!1}},V=async a=>{if(!a._name){t.error("请输入新名称");return}a._saving=!0;try{const e=await A(a.id,{name:a._name});e.code===0?(t.success("分类已更新"),await p()):t.error(e.msg||"更新失败")}catch(e){t.error(e.message||"更新失败")}finally{a._saving=!1}},k=async a=>{a._removing=!0;try{const e=await F(a.id);e.code===0?(t.success("分类已删除"),await p()):t.error(e.msg||"删除失败")}catch(e){t.error(e.message||"删除失败")}finally{a._removing=!1}};return K(p),(a,e)=>{const g=T,i=z,u=w,h=U,D=N,B=x;return C(),L("div",G,[s("section",H,[e[4]||(e[4]=s("div",{class:"page-section-title"},[s("h1",{id:"admin-categories-form-title"},"新增分类")],-1)),e[5]||(e[5]=s("p",{id:"admin-categories-form-tip",class:"sr-only"}," 填写名称及可选的父分类 ID 后点击新增，系统会在列表中展示最新分类。 ",-1)),s("div",J,[r(g,{modelValue:l.name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.name=o),placeholder:"分类名称","aria-label":"分类名称"},null,8,["modelValue"]),r(g,{modelValue:l.parentId,"onUpdate:modelValue":e[1]||(e[1]=o=>l.parentId=o),placeholder:"父分类ID（可选）","aria-label":"父分类 ID"},null,8,["modelValue"]),r(i,{type:"primary",onClick:I,loading:v.value},{default:n(()=>[...e[2]||(e[2]=[_(" 新增 ",-1)])]),_:1},8,["loading"]),r(i,{onClick:p,loading:c.value},{default:n(()=>[...e[3]||(e[3]=[_("刷新",-1)])]),_:1},8,["loading"])])]),s("section",O,[e[8]||(e[8]=s("header",{class:"table-card__header table-header"},[s("h2",{id:"admin-categories-table-title",class:"page-section-title"},"分类列表")],-1)),s("div",Q,[P((C(),E(h,{data:m.value,border:"","aria-describedby":"admin-categories-table-title"},{default:n(()=>[r(u,{prop:"id",label:"ID",width:"90"}),r(u,{label:"名称","min-width":"220"},{default:n(({row:o})=>[r(g,{modelValue:o._name,"onUpdate:modelValue":y=>o._name=y,size:"small",placeholder:"分类名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(u,{prop:"parentId",label:"父ID",width:"100"}),r(u,{label:"操作",width:"220"},{default:n(({row:o})=>[r(i,{size:"small",type:"primary",onClick:y=>V(o),loading:o._saving},{default:n(()=>[...e[6]||(e[6]=[_(" 重命名 ",-1)])]),_:1},8,["onClick","loading"]),r(i,{size:"small",type:"danger",onClick:y=>k(o),loading:o._removing},{default:n(()=>[...e[7]||(e[7]=[_(" 删除 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[B,c.value]]),!c.value&&!m.value.length?(C(),E(D,{key:0,description:"暂无分类数据"})):R("",!0)])])])}}},be=$(S,[["__scopeId","data-v-59175edc"]]);export{be as default};
