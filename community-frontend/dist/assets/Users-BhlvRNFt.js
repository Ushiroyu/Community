import{e as W,b as X,a as Y,w as Z,y as x}from"./index-BRtYqat6.js";import{v as ee,E as te,a as ae}from"./el-table-column-KoNqeqPg.js";import{E as oe,a as le,b as re}from"./el-select-BS9GzTGv.js";/* empty css               */import{u as f,d as N,E as se}from"./el-scrollbar-eEMXupeW.js";/* empty css                 */import{E as ne}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import{b as ie,m as pe,_ as de,E as ue,a as me}from"./_plugin-vue_export-helper-BH_is9DS.js";import{s as ce}from"./vendor-icons-CDwfVtjd.js";import{b as fe,u as ve,r as ge}from"./users-DXWfoKsj.js";import{E as s,h as be}from"./http-y0YsLSxU.js";import{E as _e}from"./index-C9h3pgbl.js";import{E as ye}from"./index-B89e1ymx.js";import{d as z}from"./dropdown-Ck6qUUA5.js";import{d as H,b as L,r as g,u as b,B,o as V,D as r,A as K,R as P,c as T,V as he,Q as $,P as h,a3 as Ee,p as Ue,a as m,E as o,U as Ve}from"./vendor-vue-CpX8Jn4o.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./index-BquL_2tb.js";import"./scroll-C14GUqjp.js";import"./vnode-D67uqoy8.js";import"./typescript-Bp3YSIOJ.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";const ke=X({trigger:N.trigger,triggerKeys:N.triggerKeys,placement:z.placement,disabled:N.disabled,visible:f.visible,transition:f.transition,popperOptions:z.popperOptions,tabindex:z.tabindex,content:f.content,popperStyle:f.popperStyle,popperClass:f.popperClass,enterable:{...f.enterable,default:!0},effect:{...f.effect,default:"light"},teleported:f.teleported,appendTo:f.appendTo,title:String,width:{type:[String,Number],default:150},offset:{type:Number,default:void 0},showAfter:{type:Number,default:0},hideAfter:{type:Number,default:200},autoClose:{type:Number,default:0},showArrow:{type:Boolean,default:!0},persistent:{type:Boolean,default:!0},"onUpdate:visible":{type:Function}}),we={"update:visible":u=>W(u),"before-enter":()=>!0,"before-leave":()=>!0,"after-enter":()=>!0,"after-leave":()=>!0},Ce="onUpdate:visible",Le=H({name:"ElPopover"}),Pe=H({...Le,props:ke,emits:we,setup(u,{expose:i,emit:p}){const n=u,k=L(()=>n[Ce]),c=Y("popover"),E=g(),_=L(()=>{var e;return(e=b(E))==null?void 0:e.popperRef}),R=L(()=>[{width:pe(n.width)},n.popperStyle]),U=L(()=>[c.b(),n.popperClass,{[c.m("plain")]:!!n.content}]),S=L(()=>n.transition===`${c.namespace.value}-fade-in-linear`),D=()=>{var e;(e=E.value)==null||e.hide()},I=()=>{p("before-enter")},A=()=>{p("before-leave")},a=()=>{p("after-enter")},t=()=>{p("update:visible",!1),p("after-leave")};return i({popperRef:_,hide:D}),(e,y)=>(V(),B(b(se),Ee({ref_key:"tooltipRef",ref:E},e.$attrs,{trigger:e.trigger,"trigger-keys":e.triggerKeys,placement:e.placement,disabled:e.disabled,visible:e.visible,transition:e.transition,"popper-options":e.popperOptions,tabindex:e.tabindex,content:e.content,offset:e.offset,"show-after":e.showAfter,"hide-after":e.hideAfter,"auto-close":e.autoClose,"show-arrow":e.showArrow,"aria-label":e.title,effect:e.effect,enterable:e.enterable,"popper-class":b(U),"popper-style":b(R),teleported:e.teleported,"append-to":e.appendTo,persistent:e.persistent,"gpu-acceleration":b(S),"onUpdate:visible":b(k),onBeforeShow:I,onBeforeHide:A,onShow:a,onHide:t}),{content:r(()=>[e.title?(V(),T("div",{key:0,class:he(b(c).e("title")),role:"title"},$(e.title),3)):P("v-if",!0),K(e.$slots,"default",{},()=>[h($(e.content),1)])]),default:r(()=>[e.$slots.reference?K(e.$slots,"reference",{key:0}):P("v-if",!0)]),_:3},16,["trigger","trigger-keys","placement","disabled","visible","transition","popper-options","tabindex","content","offset","show-after","hide-after","auto-close","show-arrow","aria-label","effect","enterable","popper-class","popper-style","teleported","append-to","persistent","gpu-acceleration","onUpdate:visible"]))}});var Re=ie(Pe,[["__file","popover.vue"]]);const O=(u,i)=>{const p=i.arg||i.value,n=p==null?void 0:p.popperRef;n&&(n.triggerRef=u)};var Se={mounted(u,i){O(u,i)},updated(u,i){O(u,i)}};const De="popover",Ie=x(Se,De),Ae=Z(Re,{directive:Ie}),Ne={class:"page-wrap admin-users"},ze={class:"page-card filters-card","aria-labelledby":"admin-users-filter-title","aria-describedby":"admin-users-filter-tip"},Be={class:"filters-grid"},Te={class:"table-card",role:"region","aria-labelledby":"admin-users-table-title"},$e={class:"table-card__body"},Me={class:"reset-box"},Ke={key:1,class:"pagination-bar"},Oe={__name:"Users",setup(u){const i=g(""),p=g(""),n=g([]),k=g(0),c=g(1),E=g(10),_=g(!1),R=a=>{switch(a){case"ADMIN":return"管理员";case"LEADER":return"团长";case"SUPPLIER":return"供应商";default:return"居民用户"}},U=async()=>{var a,t;_.value=!0;try{const e=await fe({page:c.value,size:E.value,keyword:i.value||void 0,role:p.value||void 0});if(e.code===0){const y=e.list||((a=e.data)==null?void 0:a.list)||[];n.value=y.map(d=>({...d,_username:d.username,_pwd:"",_role:d.role,_nameLoading:!1,_roleLoading:!1,_resetLoading:!1})),k.value=e.total??((t=e.data)==null?void 0:t.total)??y.length}else s.error(e.msg||"加载用户列表失败")}catch(e){s.error(e.message||"加载失败")}finally{_.value=!1}},S=()=>{c.value=1,U()},D=async a=>{if(!a._username){s.error("用户名不能为空");return}a._nameLoading=!0;try{const t=await ve(a.id,{nickname:a._username});t.code===0?(s.success("已更新"),a.username=a._username):s.error(t.msg||"更新失败")}catch(t){s.error(t.message||"更新失败")}finally{a._nameLoading=!1}},I=async a=>{if(!a._role){s.error("请选择角色");return}a._roleLoading=!0;try{const t=await be.put(`/users/${a.id}/role`,null,{params:{role:a._role}});t.code===0?(s.success("角色已更新"),a.role=a._role):s.error(t.msg||"更新失败")}catch(t){s.error(t.message||"更新失败")}finally{a._roleLoading=!1}},A=async a=>{if(!a._pwd){s.error("请输入新密码");return}a._resetLoading=!0;try{const t=await ge(a.id,a._pwd);t.code===0?(s.success("已重置密码"),a._pwd=""):s.error(t.msg||"重置失败")}catch(t){s.error(t.message||"重置失败")}finally{a._resetLoading=!1}};return Ue(U),(a,t)=>{const e=me,y=_e,d=re,M=oe,w=ue,C=ae,j=ye,F=Ae,Q=te,q=ne,G=le,J=ee;return V(),T("div",Ne,[m("section",ze,[t[4]||(t[4]=m("div",{class:"page-section-title"},[m("h1",{id:"admin-users-filter-title"},"用户筛选")],-1)),t[5]||(t[5]=m("p",{id:"admin-users-filter-tip",class:"sr-only"}," 可以输入用户名或 ID，并按角色筛选，点击搜索刷新列表。 ",-1)),m("div",Be,[o(y,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value=l),placeholder:"搜索用户名或ID",clearable:"","aria-label":"搜索用户名或 ID"},{prefix:r(()=>[o(e,null,{default:r(()=>[o(b(ce))]),_:1})]),_:1},8,["modelValue"]),o(M,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=l=>p.value=l),placeholder:"角色（可选）",clearable:""},{default:r(()=>[o(d,{label:"管理员",value:"ADMIN"}),o(d,{label:"团长",value:"LEADER"}),o(d,{label:"供应商",value:"SUPPLIER"}),o(d,{label:"居民用户",value:"USER"})]),_:1},8,["modelValue"]),o(w,{type:"primary",onClick:S,loading:_.value},{default:r(()=>[...t[3]||(t[3]=[h(" 搜索 ",-1)])]),_:1},8,["loading"])])]),m("section",Te,[t[10]||(t[10]=m("header",{class:"table-card__header table-header"},[m("h2",{id:"admin-users-table-title",class:"page-section-title"},"用户列表")],-1)),m("div",$e,[Ve((V(),B(Q,{data:n.value,border:"","aria-describedby":"admin-users-table-title"},{default:r(()=>[o(C,{prop:"id",label:"用户ID",width:"100"}),o(C,{label:"用户名","min-width":"220"},{default:r(({row:l})=>[o(y,{modelValue:l._username,"onUpdate:modelValue":v=>l._username=v,size:"small",placeholder:"输入昵称"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{prop:"role",label:"当前角色",width:"120"},{default:r(({row:l})=>[o(j,null,{default:r(()=>[h($(R(l.role)),1)]),_:2},1024)]),_:1}),o(C,{label:"角色设置",width:"220"},{default:r(({row:l})=>[o(M,{modelValue:l._role,"onUpdate:modelValue":v=>l._role=v,size:"small",placeholder:"选择角色",style:{width:"140px","margin-right":"6px"}},{default:r(()=>[o(d,{label:"管理员",value:"ADMIN"}),o(d,{label:"团长",value:"LEADER"}),o(d,{label:"供应商",value:"SUPPLIER"}),o(d,{label:"居民用户",value:"USER"})]),_:1},8,["modelValue","onUpdate:modelValue"]),o(w,{size:"small",type:"primary",onClick:v=>I(l),loading:l._roleLoading},{default:r(()=>[...t[6]||(t[6]=[h(" 保存 ",-1)])]),_:1},8,["onClick","loading"])]),_:1}),o(C,{label:"操作",width:"280"},{default:r(({row:l})=>[o(w,{size:"small",type:"primary",onClick:v=>D(l),loading:l._nameLoading},{default:r(()=>[...t[7]||(t[7]=[h(" 保存名称 ",-1)])]),_:1},8,["onClick","loading"]),o(F,{placement:"top",width:"240",trigger:"click"},{reference:r(()=>[o(w,{size:"small"},{default:r(()=>[...t[8]||(t[8]=[h("重置密码",-1)])]),_:1})]),default:r(()=>[m("div",Me,[o(y,{modelValue:l._pwd,"onUpdate:modelValue":v=>l._pwd=v,placeholder:"新密码",size:"small","show-password":""},null,8,["modelValue","onUpdate:modelValue"]),o(w,{size:"small",type:"primary",onClick:v=>A(l),loading:l._resetLoading},{default:r(()=>[...t[9]||(t[9]=[h(" 确定 ",-1)])]),_:1},8,["onClick","loading"])])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[J,_.value]]),!_.value&&!n.value.length?(V(),B(q,{key:0,description:"暂无数据"})):P("",!0),k.value?(V(),T("div",Ke,[o(G,{total:k.value,"current-page":c.value,"onUpdate:currentPage":t[2]||(t[2]=l=>c.value=l),"page-size":E.value,layout:"prev, pager, next, jumper",onCurrentChange:U,onSizeChange:U},null,8,["total","current-page","page-size"])])):P("",!0)])])])}}},bt=de(Oe,[["__scopeId","data-v-4a076ed1"]]);export{bt as default};
