import{u as X}from"./index-BRtYqat6.js";import{E as N,a as S}from"./el-form-item-DFokbjd4.js";/* empty css                 */import{E as F}from"./el-empty-aBf0dV6S.js";import{_ as M,E as T}from"./_plugin-vue_export-helper-BH_is9DS.js";/* empty css               */import{E as U}from"./el-skeleton-item-CblNMWFr.js";import{l as $,a as z,s as K,d as L}from"./users-DXWfoKsj.js";import{E as r}from"./http-y0YsLSxU.js";import{E as P}from"./index-B89e1ymx.js";import{E as Q}from"./index-C9h3pgbl.js";import{E as R}from"./index-DB6mTxOj.js";import{r as _,K as j,p as q,c as m,o as i,a as s,Q as y,B as k,S as G,T as H,E as l,D as n,V as J,R as O,P as u}from"./vendor-vue-CpX8Jn4o.js";import"./castArray-esTnwj7j.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./vendor-icons-CDwfVtjd.js";import"./typescript-Bp3YSIOJ.js";import"./index-DIxbWGny.js";import"./vnode-D67uqoy8.js";import"./scroll-C14GUqjp.js";import"./focus-trap-P_RRA6FG.js";import"./index-D8up7KiO.js";const W={class:"page-wrap addresses-view"},Y={class:"page-card addresses-hero","aria-labelledby":"addresses-hero-title","aria-describedby":"addresses-hero-desc"},Z={class:"stat-card"},ee={class:"stat-card__value"},se={class:"page-card address-list","aria-labelledby":"addresses-list-title",role:"region","aria-describedby":"addresses-default-tip"},te={key:1},ae={key:0,class:"address-grid"},de={class:"address-header"},oe={class:"address-id"},re={class:"address-detail"},le={class:"address-sub"},ie={class:"address-actions"},ne={class:"page-card address-form","aria-labelledby":"addresses-form-title",role:"region"},ce={__name:"Addresses",setup(me){const p=X(),f=_([]),c=_(null),v=_(!1),g=_(!1),o=j({detail:"",communityId:""}),E=async()=>{var a,e;v.value=!0;try{const d=await $(p.userId);d.code===0?(f.value=d.addresses||((a=d.data)==null?void 0:a.addresses)||d.data||[],c.value=d.defaultAddressId??((e=d.data)==null?void 0:e.defaultAddressId)??null):r.error(d.msg||"加载地址失败")}catch(d){r.error(d.message||"加载失败")}finally{v.value=!1}},h=async()=>{if(!o.detail){r.error("请填写详细地址");return}g.value=!0;try{const a={detail:o.detail,communityId:o.communityId||null},e=await z(p.userId,a);e.code===0?(r.success("地址已添加"),o.detail="",o.communityId="",await E()):r.error(e.msg||"添加失败")}catch(a){r.error(a.message||"添加失败")}finally{g.value=!1}},V=async a=>{try{await K(p.userId,a.id),r.success("默认地址已更新"),c.value=a.id}catch(e){r.error(e.message||"设置失败")}},x=async a=>{try{await R.confirm("确定删除该地址吗？","提示",{type:"warning"}),await L(p.userId,a.id),r.success("地址已删除"),await E()}catch(e){e!=="cancel"&&e!=="close"&&r.error(e.message||"删除失败")}};return q(E),(a,e)=>{const d=U,A=P,I=T,C=F,w=Q,b=S,B=N;return i(),m("div",W,[s("section",Y,[e[3]||(e[3]=s("div",null,[s("span",{class:"pill"},"收货地址"),s("h1",{id:"addresses-hero-title",class:"addresses-title"},"为每个社区成员匹配配送地址"),s("p",{id:"addresses-hero-desc",class:"addresses-desc"}," 管理常用地址可提升下单效率，系统会自动关联团长覆盖的社区范围。支持设置默认地址与快速删除。 ")],-1)),s("div",Z,[e[2]||(e[2]=s("span",{class:"stat-card__title"},"已保存地址",-1)),s("span",ee,y(f.value.length),1)]),e[4]||(e[4]=s("p",{id:"addresses-default-tip",class:"sr-only"}," 默认地址会在结算时优先使用，可随时更换或删除。 ",-1))]),s("section",se,[e[9]||(e[9]=s("header",{class:"page-section-title"},[s("h2",{id:"addresses-list-title"},"地址列表")],-1)),v.value?(i(),k(d,{key:0,animated:"",rows:4})):(i(),m("div",te,[f.value.length?(i(),m("div",ae,[(i(!0),m(G,null,H(f.value,t=>(i(),m("article",{key:t.id,class:J(["address-card",{"is-default":t.id===c.value}])},[s("div",de,[s("div",oe,"ID："+y(t.id),1),t.id===c.value?(i(),k(A,{key:0,type:"success",effect:"plain"},{default:n(()=>[...e[5]||(e[5]=[u(" 默认地址 ",-1)])]),_:1})):O("",!0)]),s("div",re,y(t.detail),1),s("div",le,[e[6]||(e[6]=u(" 社区 ID：",-1)),s("strong",null,y(t.communityId||"未关联"),1)]),s("div",ie,[l(I,{text:"",type:"primary",onClick:D=>V(t),disabled:t.id===c.value},{default:n(()=>[...e[7]||(e[7]=[u(" 设为默认 ",-1)])]),_:1},8,["onClick","disabled"]),l(I,{text:"",type:"danger",onClick:D=>x(t)},{default:n(()=>[...e[8]||(e[8]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])],2))),128))])):(i(),k(C,{key:1,description:"暂无地址，添加第一个地址方便配送吧"}))]))]),s("section",ne,[e[11]||(e[11]=s("header",{class:"page-section-title"},[s("h2",{id:"addresses-form-title"},"新增地址")],-1)),l(B,{model:o,"label-width":"98px",class:"form-content"},{default:n(()=>[l(b,{label:"详细地址"},{default:n(()=>[l(w,{modelValue:o.detail,"onUpdate:modelValue":e[0]||(e[0]=t=>o.detail=t),placeholder:"如：XX小区X栋X单元XX室"},null,8,["modelValue"])]),_:1}),l(b,{label:"社区 ID"},{default:n(()=>[l(w,{modelValue:o.communityId,"onUpdate:modelValue":e[1]||(e[1]=t=>o.communityId=t),placeholder:"可选，方便匹配团长"},null,8,["modelValue"])]),_:1}),l(b,null,{default:n(()=>[l(I,{type:"primary",loading:g.value,onClick:h},{default:n(()=>[...e[10]||(e[10]=[u(" 添加地址 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}},Me=M(ce,[["__scopeId","data-v-5444bf89"]]);export{Me as default};
