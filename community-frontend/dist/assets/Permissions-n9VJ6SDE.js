import"./index-BRtYqat6.js";import{v as B,E as M,a as T}from"./el-table-column-KoNqeqPg.js";import{E as w,a as $,b as j}from"./el-select-BS9GzTGv.js";/* empty css               */import"./el-scrollbar-eEMXupeW.js";/* empty css                 */import{E as O}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import{_ as Q,E as q}from"./_plugin-vue_export-helper-BH_is9DS.js";import{h as U,E as d}from"./http-y0YsLSxU.js";import{E as F}from"./index-C9h3pgbl.js";import{E as G}from"./index-B89e1ymx.js";import{r as n,p as H,c as k,o as g,a as r,E as a,D as i,U as J,B as D,R as C,P as y,Q as K}from"./vendor-vue-CpX8Jn4o.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./vendor-icons-CDwfVtjd.js";import"./index-BquL_2tb.js";import"./scroll-C14GUqjp.js";import"./vnode-D67uqoy8.js";import"./typescript-Bp3YSIOJ.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";const W={class:"page-wrap admin-permissions"},X={class:"page-card filters-card","aria-labelledby":"admin-permissions-filter-title","aria-describedby":"admin-permissions-filter-tip"},Y={class:"filters-grid"},Z={class:"table-card",role:"region","aria-labelledby":"admin-permissions-table-title"},ee={class:"table-card__body"},ae={key:1,class:"pagination-bar"},le={__name:"Permissions",setup(te){const v=n(""),b=n(""),f=n([]),E=n(0),u=n(1),h=n(10),p=n(!1),I=l=>{switch(l){case"ADMIN":return"管理员";case"LEADER":return"团长";case"SUPPLIER":return"供应商";default:return"居民用户"}},c=async()=>{var l,e;p.value=!0;try{const s=await U.get("/users",{params:{page:u.value,size:h.value,keyword:v.value||void 0,role:b.value||void 0}});if(s.code===0){const o=s.list||((l=s.data)==null?void 0:l.list)||[];f.value=o.map(m=>({...m,_role:m.role,_loading:!1})),E.value=s.total??((e=s.data)==null?void 0:e.total)??o.length}else d.error(s.msg||"加载失败")}catch(s){d.error(s.message||"加载失败")}finally{p.value=!1}},R=()=>{u.value=1,c()},S=async l=>{if(!l._role){d.error("请选择角色");return}l._loading=!0;try{const e=await U.put(`/users/${l.id}/role`,null,{params:{role:l._role}});e.code===0?(d.success("角色已更新"),l.role=l._role):d.error(e.msg||"更新失败")}catch(e){d.error(e.message||"更新失败")}finally{l._loading=!1}};return H(c),(l,e)=>{const s=F,o=j,m=w,V=q,_=T,x=G,L=M,z=O,N=$,A=B;return g(),k("div",W,[r("section",X,[e[4]||(e[4]=r("div",{class:"page-section-title"},[r("h1",{id:"admin-permissions-filter-title"},"角色筛选")],-1)),e[5]||(e[5]=r("p",{id:"admin-permissions-filter-tip",class:"sr-only"}," 输入用户名或选择角色后点击搜索可刷新权限列表。 ",-1)),r("div",Y,[a(s,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),placeholder:"搜索用户名",clearable:"","aria-label":"搜索用户名"},null,8,["modelValue"]),a(m,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),placeholder:"角色（可选）",clearable:""},{default:i(()=>[a(o,{label:"管理员",value:"ADMIN"}),a(o,{label:"团长",value:"LEADER"}),a(o,{label:"供应商",value:"SUPPLIER"}),a(o,{label:"居民用户",value:"USER"})]),_:1},8,["modelValue"]),a(V,{type:"primary",onClick:R,loading:p.value},{default:i(()=>[...e[3]||(e[3]=[y(" 搜索 ",-1)])]),_:1},8,["loading"])])]),r("section",Z,[e[7]||(e[7]=r("header",{class:"table-card__header table-header"},[r("h2",{id:"admin-permissions-table-title",class:"page-section-title"},"权限列表")],-1)),r("div",ee,[J((g(),D(L,{data:f.value,border:"","aria-describedby":"admin-permissions-table-title"},{default:i(()=>[a(_,{prop:"id",label:"用户ID",width:"100"}),a(_,{prop:"username",label:"用户名"}),a(_,{prop:"role",label:"当前角色",width:"140"},{default:i(({row:t})=>[a(x,null,{default:i(()=>[y(K(I(t.role)),1)]),_:2},1024)]),_:1}),a(_,{label:"角色配置",width:"220"},{default:i(({row:t})=>[a(m,{modelValue:t._role,"onUpdate:modelValue":P=>t._role=P,placeholder:"选择角色",size:"small",style:{width:"150px","margin-right":"6px"}},{default:i(()=>[a(o,{label:"管理员",value:"ADMIN"}),a(o,{label:"团长",value:"LEADER"}),a(o,{label:"供应商",value:"SUPPLIER"}),a(o,{label:"居民用户",value:"USER"})]),_:1},8,["modelValue","onUpdate:modelValue"]),a(V,{size:"small",type:"primary",onClick:P=>S(t),loading:t._loading},{default:i(()=>[...e[6]||(e[6]=[y(" 保存 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[A,p.value]]),!p.value&&!f.value.length?(g(),D(z,{key:0,description:"暂无数据"})):C("",!0),E.value?(g(),k("div",ae,[a(N,{total:E.value,"current-page":u.value,"onUpdate:currentPage":e[2]||(e[2]=t=>u.value=t),"page-size":h.value,layout:"prev, pager, next, jumper",onCurrentChange:c,onSizeChange:c},null,8,["total","current-page","page-size"])])):C("",!0)])])])}}},xe=Q(le,[["__scopeId","data-v-c8f9e482"]]);export{xe as default};
