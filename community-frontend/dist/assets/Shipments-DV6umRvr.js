import{u as I}from"./index-BRtYqat6.js";import{v as N,E as D,a as S}from"./el-table-column-KoNqeqPg.js";import{E as x}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-eEMXupeW.js";/* empty css               */import{_ as B,E as C}from"./_plugin-vue_export-helper-BH_is9DS.js";/* empty css                 */import{m as L,s as U,p as T}from"./supplier-DrPTNbdy.js";import{E as M}from"./index-C9h3pgbl.js";import{E as n}from"./http-y0YsLSxU.js";import{r as u,p as z,c as F,o as _,a as s,E as o,D as d,U as O,B as g,R as P,P as h,Q}from"./vendor-vue-CpX8Jn4o.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./vendor-icons-CDwfVtjd.js";import"./index-BquL_2tb.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";import"./typescript-Bp3YSIOJ.js";const R={class:"page-wrap supplier-shipments"},$={class:"page-card shipments-hero","aria-labelledby":"supplier-shipments-title","aria-describedby":"supplier-shipments-desc"},j={class:"hero-actions","aria-label":"供应商筛选"},q={class:"table-card",role:"region","aria-labelledby":"supplier-shipments-table-title"},A={class:"table-card__body"},G={__name:"Shipments",setup(H){const v=I(),p=u(""),c=u([]),m=u(!1),y=t=>(Number(t)||0).toFixed(2);z(async()=>{var t,e,r;try{if(v.isSupplier&&!p.value){const a=await L(),i=((t=a==null?void 0:a.supplier)==null?void 0:t.id)??((r=(e=a==null?void 0:a.data)==null?void 0:e.supplier)==null?void 0:r.id);i&&(p.value=String(i))}}catch(a){console.warn("自动获取供应商ID失败",a)}});const b=async()=>{var t;if(!p.value){n.warning("请先输入供应商ID");return}m.value=!0;try{const e=await T(p.value);if(e.code===0){const r=e.list??((t=e.data)==null?void 0:t.list)??e.orders??[];c.value=r.map(a=>({...a,_trackingNo:"",_shipLoading:!1}))}else n.error(e.msg||"加载待发货订单失败")}catch(e){n.error(e.message||"加载失败")}finally{m.value=!1}},E=async t=>{if(!t._trackingNo){n.warning("请填写物流单号");return}t._shipLoading=!0;try{const e=await U(t.orderId,t._trackingNo);e.code===0?(n.success("发货成功"),await b()):n.error(e.msg||"发货失败")}catch(e){n.error(e.message||"发货异常")}finally{t._shipLoading=!1}};return(t,e)=>{const r=M,a=C,i=S,k=D,V=x,w=N;return _(),F("div",R,[s("section",$,[e[2]||(e[2]=s("div",null,[s("span",{class:"pill"},"发货管理"),s("h1",{id:"supplier-shipments-title",class:"hero-title"},"批量处理配送单据"),s("p",{id:"supplier-shipments-desc",class:"hero-desc"}," 输入供应商 ID 自动查询待发货订单，录入物流单号后即可完成发货确认。 "),s("p",{class:"sr-only"}," 输入供应商编号后点击查询即可加载待发货订单，填写物流单号并点击发货更新状态。 ")],-1)),s("div",j,[o(r,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),placeholder:"供应商 ID",clearable:"",style:{width:"220px"},"aria-label":"输入供应商 ID"},null,8,["modelValue"]),o(a,{type:"primary",onClick:b,loading:m.value},{default:d(()=>[...e[1]||(e[1]=[h("查询待发货",-1)])]),_:1},8,["loading"])])]),s("section",q,[e[4]||(e[4]=s("header",{class:"table-card__header table-header"},[s("h2",{id:"supplier-shipments-table-title",class:"page-section-title"},"待发货订单")],-1)),s("div",A,[O((_(),g(k,{data:c.value,border:"","aria-describedby":"supplier-shipments-table-title"},{default:d(()=>[o(i,{prop:"orderId",label:"订单号",width:"140"}),o(i,{label:"金额",width:"120"},{default:d(({row:l})=>[h("¥ "+Q(y(l.amount)),1)]),_:1}),o(i,{prop:"status",label:"状态",width:"120"}),o(i,{label:"物流单号","min-width":"220"},{default:d(({row:l})=>[o(r,{modelValue:l._trackingNo,"onUpdate:modelValue":f=>l._trackingNo=f,placeholder:"请输入物流单号"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(i,{label:"操作",width:"160",align:"center"},{default:d(({row:l})=>[o(a,{size:"small",type:"primary",onClick:f=>E(l),loading:l._shipLoading},{default:d(()=>[...e[3]||(e[3]=[h(" 发货 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[w,m.value]]),!m.value&&!c.value.length?(_(),g(V,{key:0,description:"暂无待发货订单"})):P("",!0)])])])}}},ge=B(G,[["__scopeId","data-v-0f6bda36"]]);export{ge as default};
