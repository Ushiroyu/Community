import{b as G,i as Y,a as j,w as se,c as ae,u as re}from"./index-BRtYqat6.js";import{E as oe,a as le}from"./el-form-item-DFokbjd4.js";/* empty css                 */import{E as ne}from"./el-input-number-B8mXtdEx.js";import{E as ie}from"./el-empty-aBf0dV6S.js";import{E as ue,b as de}from"./el-radio-group-CAhw3ZdG.js";/* empty css               */import{E as ce}from"./el-skeleton-item-CblNMWFr.js";import{b as H,i as pe,a as U,_ as me,E as ve}from"./_plugin-vue_export-helper-BH_is9DS.js";import{d as O,m as K,c as I,o as p,A as M,E as i,u as t,V as _,g as J,z as fe,r as V,i as _e,p as Q,b as S,W as ye,R as B,a as l,X as L,B as k,D as c,Y as he,Q as T,P as x,K as Se,M as ge,S as ke,T as be}from"./vendor-vue-CpX8Jn4o.js";import{c as Ee,a as Ie,n as Ce}from"./vendor-icons-CDwfVtjd.js";import{l as we}from"./users-DXWfoKsj.js";import{g as Ve}from"./leader-BM-s6ogo.js";import{c as $e,p as Ne}from"./orders-BKzCgbou.js";import{C as X,E}from"./http-y0YsLSxU.js";import{u as Be}from"./index-CXtSBroR.js";import{E as xe}from"./index-B89e1ymx.js";import{E as De}from"./index-C9h3pgbl.js";import"./castArray-esTnwj7j.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./index-eOEDSGTO.js";import"./isEqual-BuOCdSDg.js";import"./typescript-Bp3YSIOJ.js";import"./vnode-D67uqoy8.js";const Pe=G({space:{type:[Number,String],default:""},active:{type:Number,default:0},direction:{type:String,default:"horizontal",values:["horizontal","vertical"]},alignCenter:{type:Boolean},simple:{type:Boolean},finishStatus:{type:String,values:["wait","process","finish","error","success"],default:"finish"},processStatus:{type:String,values:["wait","process","finish","error","success"],default:"process"}}),Ae={[X]:($,g)=>[$,g].every(Y)},Z="ElSteps",Te=O({name:"ElSteps"}),qe=O({...Te,props:Pe,emits:Ae,setup($,{emit:g}){const a=$,m=j("steps"),{children:v,addChild:y,removeChild:r,ChildrenSorter:C}=Be(J(),"ElStep");return K(v,()=>{v.value.forEach((o,b)=>{o.setIndex(b)})}),fe(Z,{props:a,steps:v,addStep:y,removeStep:r}),K(()=>a.active,(o,b)=>{g(X,o,b)}),(o,b)=>(p(),I("div",{class:_([t(m).b(),t(m).m(o.simple?"simple":o.direction)])},[M(o.$slots,"default"),i(t(C))],2))}});var ze=H(qe,[["__file","steps.vue"]]);const Re=G({title:{type:String,default:""},icon:{type:pe},description:{type:String,default:""},status:{type:String,values:["","wait","process","finish","error","success"],default:""}}),Ue=O({name:"ElStep"}),Me=O({...Ue,props:Re,setup($){const g=$,a=j("step"),m=V(-1),v=V({}),y=V(""),r=_e(Z),C=J();Q(()=>{K([()=>r.props.active,()=>r.props.processStatus,()=>r.props.finishStatus],([s])=>{F(s)},{immediate:!0})});const o=S(()=>g.status||y.value),b=S(()=>{const s=r.steps.value[m.value-1];return s?s.internalStatus.value:"wait"}),D=S(()=>r.props.alignCenter),q=S(()=>r.props.direction==="vertical"),u=S(()=>r.props.simple),e=S(()=>r.steps.value.length),n=S(()=>{var s;return((s=r.steps.value[e.value-1])==null?void 0:s.uid)===C.uid}),d=S(()=>u.value?"":r.props.space),w=S(()=>[a.b(),a.is(u.value?"simple":r.props.direction),a.is("flex",n.value&&!d.value&&!D.value),a.is("center",D.value&&!q.value&&!u.value)]),N=S(()=>{const s={flexBasis:Y(d.value)?`${d.value}px`:d.value?d.value:`${100/(e.value-(D.value?0:1))}%`};return q.value||n.value&&(s.maxWidth=`${100/e.value}%`),s}),P=s=>{m.value=s},W=s=>{const h=s==="wait",A={transitionDelay:`${h?"-":""}${150*m.value}ms`},R=s===r.props.processStatus||h?0:100;A.borderWidth=R&&!u.value?"1px":0,A[r.props.direction==="vertical"?"height":"width"]=`${R}%`,v.value=A},F=s=>{s>m.value?y.value=r.props.finishStatus:s===m.value&&b.value!=="error"?y.value=r.props.processStatus:y.value="wait";const h=r.steps.value[m.value-1];h&&h.calcProgress(y.value)},z={uid:C.uid,getVnode:()=>C.vnode,currentStatus:o,internalStatus:y,setIndex:P,calcProgress:W};return r.addStep(z),ye(()=>{r.removeStep(z)}),(s,h)=>(p(),I("div",{style:L(t(N)),class:_(t(w))},[B(" icon & line "),l("div",{class:_([t(a).e("head"),t(a).is(t(o))])},[t(u)?B("v-if",!0):(p(),I("div",{key:0,class:_(t(a).e("line"))},[l("i",{class:_(t(a).e("line-inner")),style:L(v.value)},null,6)],2)),l("div",{class:_([t(a).e("icon"),t(a).is(s.icon||s.$slots.icon?"icon":"text")])},[M(s.$slots,"icon",{},()=>[s.icon?(p(),k(t(U),{key:0,class:_(t(a).e("icon-inner"))},{default:c(()=>[(p(),k(he(s.icon)))]),_:1},8,["class"])):t(o)==="success"?(p(),k(t(U),{key:1,class:_([t(a).e("icon-inner"),t(a).is("status")])},{default:c(()=>[i(t(Ee))]),_:1},8,["class"])):t(o)==="error"?(p(),k(t(U),{key:2,class:_([t(a).e("icon-inner"),t(a).is("status")])},{default:c(()=>[i(t(Ie))]),_:1},8,["class"])):t(u)?B("v-if",!0):(p(),I("div",{key:3,class:_(t(a).e("icon-inner"))},T(m.value+1),3))])],2)],2),B(" title & description "),l("div",{class:_(t(a).e("main"))},[l("div",{class:_([t(a).e("title"),t(a).is(t(o))])},[M(s.$slots,"title",{},()=>[x(T(s.title),1)])],2),t(u)?(p(),I("div",{key:0,class:_(t(a).e("arrow"))},null,2)):(p(),I("div",{key:1,class:_([t(a).e("description"),t(a).is(t(o))])},[M(s.$slots,"description",{},()=>[x(T(s.description),1)])],2))],2)],6))}});var ee=H(Me,[["__file","item.vue"]]);const Oe=se(ze,{Step:ee}),We=ae(ee),Fe={class:"page-wrap checkout-view"},Ke={class:"page-card checkout-hero","aria-labelledby":"checkout-hero-title","aria-describedby":"checkout-instructions"},Le={class:"checkout-body"},Ge={class:"page-card address-card","aria-labelledby":"checkout-address-title",role:"region","aria-describedby":"checkout-instructions"},Ye={class:"page-section-title"},je={class:"address-meta"},He={class:"address-detail"},Je={class:"address-sub"},Qe={class:"page-card order-card","aria-labelledby":"checkout-form-title",role:"region","aria-describedby":"checkout-instructions"},Xe={class:"order-tip"},Ze={__name:"Checkout",setup($){const g=ge(),a=re(),m=V([]),v=V(null),y=V(!1),r=V(!1),C=S(()=>v.value?r.value?2:1:0),o=Se({productId:null,quantity:1,remark:""}),b=async()=>{var u,e;y.value=!0;try{const n=await we(a.userId);if(n.code===0){m.value=n.addresses||((u=n.data)==null?void 0:u.addresses)||n.data||[];const d=n.defaultAddressId??((e=n.data)==null?void 0:e.defaultAddressId);d&&(v.value=d)}}catch(n){E.error(n.message||"地址加载失败")}finally{y.value=!1}},D=async u=>{var n,d;return u&&((d=(n=(await Ve(u)).data)==null?void 0:n.community)==null?void 0:d.leaderId)||null},q=async()=>{var u;if(!v.value){E.error("请选择收货地址");return}if(!o.productId||!o.quantity){E.error("请填写商品 ID 和数量");return}r.value=!0;try{const e=m.value.find(P=>P.id===v.value),n=await D(e==null?void 0:e.communityId);if(!n){E.error("该地址暂未绑定团长，请更换地址"),r.value=!1;return}const d=await $e({userId:a.userId,leaderId:n,productId:o.productId,quantity:o.quantity,addressId:v.value,remark:o.remark});if(d.code!==0){E.error(d.msg||"下单失败"),r.value=!1;return}const w=(u=d.data)==null?void 0:u.orderId,N=await Ne(w);N.code===0?(E.success("支付成功，前往订单中心查看进度"),g.push("/u/orders")):E.error(N.msg||"支付失败")}catch(e){E.error(e.message||"支付异常")}finally{r.value=!1}};return Q(b),(u,e)=>{const n=We,d=Oe,w=ve,N=ce,P=xe,W=de,F=ue,z=ie,s=De,h=le,A=ne,R=oe,te=U;return p(),I("div",Fe,[l("section",Ke,[e[6]||(e[6]=l("div",null,[l("span",{class:"pill"},"订单结算"),l("h1",{id:"checkout-hero-title",class:"checkout-title"},"确认收货信息并完成支付"),l("p",{class:"checkout-desc"}," 核对收货地址、商品数量后即可生成订单并自动完成支付。系统会为您匹配负责该社区的团长开展配送。 ")],-1)),i(d,{active:C.value,"align-center":"","finish-status":"success"},{default:c(()=>[i(n,{title:"选择地址",description:"绑定社区与团长"}),i(n,{title:"确认商品",description:"填写商品与数量"}),i(n,{title:"支付完成",description:"等待配送"})]),_:1},8,["active"]),e[7]||(e[7]=l("p",{id:"checkout-instructions",class:"sr-only"}," 先选择一个已保存的收货地址，确认商品编号和数量，再提交订单并完成支付。 ",-1))]),l("div",Le,[l("section",Ge,[l("header",Ye,[e[9]||(e[9]=l("h2",{id:"checkout-address-title"},"收货地址",-1)),i(w,{type:"primary",text:"",onClick:e[0]||(e[0]=f=>t(g).push("/u/addresses"))},{default:c(()=>[...e[8]||(e[8]=[x(" 管理地址 ",-1)])]),_:1})]),y.value?(p(),k(N,{key:0,animated:"",rows:3})):(p(),k(F,{key:1,modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=f=>v.value=f),class:"address-group"},{default:c(()=>[(p(!0),I(ke,null,be(m.value,f=>(p(),k(W,{key:f.id,label:f.id,border:"",class:"address-item"},{default:c(()=>[l("div",je,[l("div",He,T(f.detail),1),l("div",Je," 社区 ID："+T(f.communityId||"未关联"),1)]),v.value===f.id?(p(),k(P,{key:0,type:"success",effect:"plain"},{default:c(()=>[...e[10]||(e[10]=[x(" 使用中 ",-1)])]),_:1})):B("",!0)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])),!y.value&&!m.value.length?(p(),k(z,{key:2,description:"您还没有可用的收货地址"},{default:c(()=>[i(w,{type:"primary",onClick:e[2]||(e[2]=f=>t(g).push("/u/addresses"))},{default:c(()=>[...e[11]||(e[11]=[x(" 去添加地址 ",-1)])]),_:1})]),_:1})):B("",!0)]),l("section",Qe,[e[14]||(e[14]=l("header",{class:"page-section-title"},[l("h2",{id:"checkout-form-title"},"填写订单")],-1)),i(R,{"label-width":"96px",model:o,class:"order-form"},{default:c(()=>[i(h,{label:"商品 ID"},{default:c(()=>[i(s,{modelValue:o.productId,"onUpdate:modelValue":e[3]||(e[3]=f=>o.productId=f),modelModifiers:{number:!0},placeholder:"请输入商品 ID",clearable:""},null,8,["modelValue"])]),_:1}),i(h,{label:"购买数量"},{default:c(()=>[i(A,{modelValue:o.quantity,"onUpdate:modelValue":e[4]||(e[4]=f=>o.quantity=f),min:1,max:999},null,8,["modelValue"])]),_:1}),i(h,{label:"备注信息"},{default:c(()=>[i(s,{modelValue:o.remark,"onUpdate:modelValue":e[5]||(e[5]=f=>o.remark=f),placeholder:"可填写配送需求或团长备注",type:"textarea",rows:"2"},null,8,["modelValue"])]),_:1}),i(h,null,{default:c(()=>[i(w,{type:"primary",size:"large",loading:r.value,onClick:q},{default:c(()=>[...e[12]||(e[12]=[x(" 提交订单并支付 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),l("div",Xe,[i(te,null,{default:c(()=>[i(t(Ce))]),_:1}),e[13]||(e[13]=l("span",null,"若商品库存不足或团长暂时未接单，系统会自动退款。",-1))])])])])}}},Ct=me(Ze,[["__scopeId","data-v-c9006048"]]);export{Ct as default};
