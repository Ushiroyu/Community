import{u as T}from"./index-BRtYqat6.js";import{v as U,E as V,a as A}from"./el-table-column-KoNqeqPg.js";import{E as F}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-eEMXupeW.js";/* empty css               */import{_ as Q,E as S}from"./_plugin-vue_export-helper-BH_is9DS.js";import{r as h,b as k,p as $,c as z,o as w,a,Q as s,E as r,D as o,U as G,B as E,M as L,P as i,u as O}from"./vendor-vue-CpX8Jn4o.js";import{l as P,r as R,c as j}from"./cart-CrYWUkoX.js";import{E as d}from"./http-y0YsLSxU.js";import{E as H}from"./index-DB6mTxOj.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./vendor-icons-CDwfVtjd.js";import"./index-BquL_2tb.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";import"./typescript-Bp3YSIOJ.js";import"./index-C9h3pgbl.js";import"./index-DIxbWGny.js";import"./vnode-D67uqoy8.js";import"./scroll-C14GUqjp.js";import"./index-D8up7KiO.js";const J={class:"page-wrap cart-view"},K={class:"page-card cart-hero","aria-labelledby":"cart-hero-title","aria-describedby":"cart-status"},W={class:"cart-hero-meta"},X={class:"meta-block"},Y={class:"meta-value"},Z={class:"meta-block"},tt={class:"meta-value"},at={class:"meta-block"},et={class:"meta-value"},st={id:"cart-status",class:"sr-only",role:"status"},lt={class:"cart-body"},ot={class:"table-card","aria-labelledby":"cart-details-title",role:"region"},rt={class:"table-card__header cart-table-header"},it={class:"cart-header-actions"},nt={class:"table-card__body",id:"cart-table-desc"},dt={class:"product-cell"},ct={class:"product-thumb"},ut={class:"product-name"},mt={class:"product-id"},pt={class:"page-card cart-summary","aria-labelledby":"cart-summary-title","aria-live":"polite"},vt={class:"summary-row"},_t={class:"summary-row"},yt={class:"summary-row summary-total"},bt={__name:"Cart",setup(ft){const C=L(),y=T(),n=h([]),m=h(!1),b=h(null),p=k(()=>n.value.length>0),v=k(()=>g(n.value.reduce((e,t)=>e+(t.price||0)*(t.quantity||0),0))),f=k(()=>n.value.reduce((e,t)=>e+(t.quantity||0),0)),g=e=>(Number(e)||0).toFixed(2),x=(e="")=>e?e.slice(0,2).toUpperCase():"GO",_=async()=>{var e;m.value=!0;try{const t=await P(y.userId);t.code===0||t.success===!0?n.value=((e=t.data)==null?void 0:e.items)||t.items||[]:d.error(t.msg||"加载购物车失败")}catch(t){d.error(t.message||"加载失败")}finally{m.value=!1}},I=async e=>{b.value=e;try{await R(y.userId,e),d.success("已移除商品"),await _()}catch(t){d.error(t.message||"移除失败")}finally{b.value=null}},B=async()=>{if(p.value)try{await H.confirm("确认清空购物车？","提示",{type:"warning"}),await j(y.userId),d.success("购物车已清空"),await _()}catch(e){e!=="cancel"&&e!=="close"&&d.error(e.message||"清空失败")}},N=()=>{C.push("/u/checkout")};return $(_),(e,t)=>{const c=S,u=A,q=V,D=F,M=U;return w(),z("div",J,[a("section",K,[t[4]||(t[4]=a("div",null,[a("span",{class:"pill"},"购物车"),a("h1",{id:"cart-hero-title",class:"cart-title"},"待结算商品清单"),a("p",{class:"cart-desc"}," 汇总所有加入购物车的商品，支持一键刷新库存与价格。请在结算前确认配送地址与团长范围。 ")],-1)),a("div",W,[a("div",X,[a("span",Y,s(f.value),1),t[1]||(t[1]=a("span",{class:"meta-label"},"件商品",-1))]),a("div",Z,[a("span",tt,"¥ "+s(v.value),1),t[2]||(t[2]=a("span",{class:"meta-label"},"预计合计",-1))]),a("div",at,[a("span",et,s(n.value.length),1),t[3]||(t[3]=a("span",{class:"meta-label"},"待处理条目",-1))])]),a("p",st," 当前购物车包含 "+s(n.value.length)+" 种商品，共 "+s(f.value)+" 件，预计金额 "+s(v.value)+" 元。 ",1)]),a("div",lt,[a("section",ot,[a("header",rt,[t[7]||(t[7]=a("div",null,[a("h2",{id:"cart-details-title",class:"page-section-title"},"购物车明细"),a("p",{class:"muted"},"可在下单前修改数量，随时掌握商品库存动态。")],-1)),a("div",it,[r(c,{text:"",type:"primary",onClick:_,loading:m.value},{default:o(()=>[...t[5]||(t[5]=[i(" 刷新库存 ",-1)])]),_:1},8,["loading"]),r(c,{text:"",type:"danger",onClick:B,disabled:!p.value},{default:o(()=>[...t[6]||(t[6]=[i(" 清空购物车 ",-1)])]),_:1},8,["disabled"])])]),a("div",nt,[p.value?G((w(),E(q,{key:0,data:n.value,border:"","aria-label":"购物车商品列表"},{default:o(()=>[r(u,{label:"商品","min-width":"240"},{default:o(({row:l})=>[a("div",dt,[a("div",ct,s(x(l.productName)),1),a("div",null,[a("div",ut,s(l.productName),1),a("div",mt,"ID："+s(l.productId),1)])])]),_:1}),r(u,{label:"单价",width:"140",align:"center"},{default:o(({row:l})=>[i("¥ "+s(g(l.price)),1)]),_:1}),r(u,{label:"数量",width:"120",align:"center"},{default:o(({row:l})=>[i(s(l.quantity),1)]),_:1}),r(u,{label:"小计",width:"160",align:"center"},{default:o(({row:l})=>[i(" ¥ "+s(g((l.price||0)*l.quantity)),1)]),_:1}),r(u,{label:"操作",width:"140",align:"center"},{default:o(({row:l})=>[r(c,{text:"",type:"danger",onClick:gt=>I(l.productId),loading:b.value===l.productId},{default:o(()=>[...t[8]||(t[8]=[i(" 移除 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[M,m.value]]):(w(),E(D,{key:1,description:"购物车空空如也，去挑选心仪商品吧"},{default:o(()=>[r(c,{type:"primary",onClick:t[0]||(t[0]=l=>O(C).push("/shop"))},{default:o(()=>[...t[9]||(t[9]=[i(" 去逛逛 ",-1)])]),_:1})]),_:1}))])]),a("aside",pt,[t[14]||(t[14]=a("h2",{id:"cart-summary-title"},"结算信息",-1)),a("div",vt,[t[10]||(t[10]=a("span",null,"商品数量",-1)),a("span",null,s(f.value),1)]),a("div",_t,[t[11]||(t[11]=a("span",null,"金额小计",-1)),a("span",null,"¥ "+s(v.value),1)]),a("div",yt,[t[12]||(t[12]=a("span",null,"应付金额",-1)),a("span",null,"¥ "+s(v.value),1)]),r(c,{type:"primary",size:"large",disabled:!p.value,onClick:N},{default:o(()=>[...t[13]||(t[13]=[i(" 去结算 ",-1)])]),_:1},8,["disabled"]),t[15]||(t[15]=a("p",{class:"summary-tip"},"结算时可选择社区地址，支持团长配送/自提。",-1))])])])}}},Jt=Q(bt,[["__scopeId","data-v-4e4da341"]]);export{Jt as default};
