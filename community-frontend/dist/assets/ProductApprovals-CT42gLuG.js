import"./index-BRtYqat6.js";import{v as D,E as L,a as N}from"./el-table-column-KoNqeqPg.js";import{E as P}from"./el-empty-aBf0dV6S.js";import"./el-checkbox-BY45api5.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-eEMXupeW.js";/* empty css               */import{_ as R,E as S}from"./_plugin-vue_export-helper-BH_is9DS.js";/* empty css                 */import{p as $}from"./products-BcjaDRHQ.js";import{c as C}from"./admin-C6mbQG5y.js";import{E as A}from"./index-C9h3pgbl.js";import{E as p}from"./http-y0YsLSxU.js";import{r as g,p as I,c as z,o as w,a as l,Q as E,E as o,D as n,U as T,B as x,R as M,P as c}from"./vendor-vue-CpX8Jn4o.js";import"./_Uint8Array-CSQzEANR.js";import"./_initCloneObject-CQpWRfh0.js";import"./_baseIteratee-BeonsPYq.js";import"./isEqual-BuOCdSDg.js";import"./castArray-esTnwj7j.js";import"./debounce-Bg3a7BCK.js";import"./vendor-icons-CDwfVtjd.js";import"./index-BquL_2tb.js";import"./index-CkCNIzEM.js";import"./focus-trap-P_RRA6FG.js";import"./typescript-Bp3YSIOJ.js";const O={class:"page-wrap product-approvals"},F={class:"page-card approvals-hero","aria-labelledby":"product-approvals-title","aria-describedby":"product-approvals-desc"},Q={class:"sr-only"},q={class:"hero-actions","aria-label":"筛选与批量操作"},G={class:"table-card",role:"region","aria-labelledby":"product-approvals-table-title"},H={class:"table-card__body"},J={__name:"ProductApprovals",setup(K){const _=g(""),u=g([]),d=g(!1),v=g([]),V=t=>(Number(t)||0).toFixed(2),f=async()=>{var t;d.value=!0;try{const e=await $({page:1,size:50,keyword:_.value||void 0,approved:!1});if(e.code===0){const a=e.list||((t=e.data)==null?void 0:t.list)||e.records||[];u.value=a.map(s=>({...s,_loading:!1}))}else p.error(e.msg||"加载失败")}catch(e){p.error(e.message||"加载失败")}finally{d.value=!1}},k=async(t,e)=>{t._loading=!0;try{const a=await C(t.id,e);a.code===0?(p.success(e?"已通过":"已拒绝"),await f()):p.error(a.msg||"操作失败")}catch(a){p.error(a.message||"操作失败")}finally{t._loading=!1}},B=t=>{v.value=t||[]},h=async t=>{if(v.value.length){d.value=!0;try{for(const e of v.value)await C(e.id,t);p.success(t?"批量通过完成":"批量拒绝完成"),await f()}catch(e){p.error(e.message||"批量操作失败")}finally{d.value=!1}}},U=()=>{const t=u.value||[],a=[["ID","名称","价格","库存"].join(",")];for(const m of t)a.push([m.id,m.name,m.price,m.stock].map(y=>`"${(y??"").toString().replaceAll('"','""')}"`).join(","));const s=new Blob([a.join(`
`)],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),b=document.createElement("a");b.href=i,b.download="products_pending.csv",b.click(),URL.revokeObjectURL(i)};return I(f),(t,e)=>{const a=A,s=S,i=N,b=L,m=P,y=D;return w(),z("div",O,[l("section",F,[l("div",null,[e[3]||(e[3]=l("span",{class:"pill"},"商品审核",-1)),e[4]||(e[4]=l("h1",{id:"product-approvals-title",class:"hero-title"},"审核待上架商品",-1)),e[5]||(e[5]=l("p",{id:"product-approvals-desc",class:"hero-desc"}," 支持关键词搜索、批量通过/拒绝以及导出待审核商品，确保商品信息规范。 ",-1)),l("p",Q," 当前待审核商品共 "+E(u.value.length)+" 个，可批量操作或单独审批。 ",1)]),l("div",q,[o(a,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r),placeholder:"输入关键词",clearable:"","aria-label":"输入商品搜索关键词"},null,8,["modelValue"]),o(s,{type:"primary",onClick:f,loading:d.value},{default:n(()=>[...e[6]||(e[6]=[c("搜索",-1)])]),_:1},8,["loading"]),o(s,{type:"success",onClick:e[1]||(e[1]=r=>h(!0)),disabled:!v.value.length},{default:n(()=>[...e[7]||(e[7]=[c(" 批量通过 ",-1)])]),_:1},8,["disabled"]),o(s,{type:"warning",onClick:e[2]||(e[2]=r=>h(!1)),disabled:!v.value.length},{default:n(()=>[...e[8]||(e[8]=[c(" 批量拒绝 ",-1)])]),_:1},8,["disabled"]),o(s,{onClick:U,disabled:!u.value.length},{default:n(()=>[...e[9]||(e[9]=[c("导出 CSV",-1)])]),_:1},8,["disabled"])])]),l("section",G,[e[12]||(e[12]=l("header",{class:"table-card__header table-header"},[l("h2",{id:"product-approvals-table-title",class:"page-section-title"},"待审核商品")],-1)),l("div",H,[T((w(),x(b,{data:u.value,"row-key":"id",border:"",onSelectionChange:B,"aria-describedby":"product-approvals-table-title"},{default:n(()=>[o(i,{type:"selection",width:"50"}),o(i,{prop:"id",label:"ID",width:"80"}),o(i,{prop:"name",label:"名称","min-width":"200"}),o(i,{label:"价格",width:"120"},{default:n(({row:r})=>[c("¥ "+E(V(r.price)),1)]),_:1}),o(i,{prop:"stock",label:"库存",width:"100"}),o(i,{label:"操作",width:"200"},{default:n(({row:r})=>[o(s,{type:"primary",size:"small",onClick:j=>k(r,!0),loading:r._loading},{default:n(()=>[...e[10]||(e[10]=[c(" 通过 ",-1)])]),_:1},8,["onClick","loading"]),o(s,{type:"danger",size:"small",onClick:j=>k(r,!1),loading:r._loading},{default:n(()=>[...e[11]||(e[11]=[c(" 拒绝 ",-1)])]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["data"])),[[y,d.value]]),!d.value&&!u.value.length?(w(),x(m,{key:0,description:"暂无待审核商品"})):M("",!0)])])])}}},ke=R(J,[["__scopeId","data-v-dc4ee290"]]);export{ke as default};
